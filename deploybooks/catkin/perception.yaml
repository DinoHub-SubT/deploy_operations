# //////////////////////////////////////////////////////////////////////////////
- ws.catkin:
# //////////////////////////////////////////////////////////////////////////////

  # run catkin builds inside the docker container
  - +docker:$DOCKER_CONTAINER

  - echo "...catkin build inside container $DOCKER_CONTAINER"

  - cd $SUBT_PATH/
  - pwd
  - whoami

  # ////////////////////////////////////////////////////////////////////////////
  - clean:
  # ////////////////////////////////////////////////////////////////////////////
    - rm -rf ~/deploy_ws/devel/$CATKIN_PROFILE_PATH
    - rm -rf ~/deploy_ws/build/$CATKIN_PROFILE_PATH
    - rm -rf ~/deploy_ws/install/$CATKIN_PROFILE_PATH
    - rm -rf ~/deploy_ws/logs/$CATKIN_PROFILE_PATH

  # ////////////////////////////////////////////////////////////////////////////
  - build:
  # ////////////////////////////////////////////////////////////////////////////
    # temporary: this is needed or wont find 'catkin' for build
    - source /opt/ros/melodic/setup.bash

    - common:
      - cd ~/deploy_ws/src/common
      - rm -f .catkin_tools/profiles/profiles.yaml
      - catkin profile list
      - catkin profile set perception.${COMPUTER_ARCH}
      - catkin config
      - catkin build --force-cmake

    - perception:
      - deps:
        # build perception deps
        - cd ~/deploy_ws/src/perception/deps/catkin
        - rm -f .catkin_tools/profiles/profiles.yaml
        - catkin profile list
        -  catkin profile set perception.${COMPUTER_ARCH}
        - catkin config
        - catkin build --force-cmake
      - objdet:
        # build objdet
        - cd ~/deploy_ws/src/perception/
        - rm -f .catkin_tools/profiles/profiles.yaml
        - catkin profile list
        - catkin profile set perception.${COMPUTER_ARCH}
        - catkin config
        - catkin build --force-cmake

    - subt_launch:
      - cd ~/deploy_ws/src/subt_launch
      - rm -f .catkin_tools/profiles/profiles.yaml
      - catkin profile list
      - catkin profile set perception.${COMPUTER_ARCH}
      - catkin config
      - catkin build --force-cmake
